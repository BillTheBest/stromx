<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>stromx: File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stromx-logo-rgb-64x64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">stromx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Welcome to stromx!</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">File </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial the very same stream as in <a class="el" href="simple.html">Simple</a> is constructed. However, this time it is deserialized from an XML file instead of manually assembled by <em>core</em> library functions. The XML file which encodes this stream looks as follows:</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> ?&gt;</div>
<div class="line"></div>
<div class="line">&lt;Stromx version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">    &lt;Stream&gt;</div>
<div class="line">        &lt;Operator <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> type=<span class="stringliteral">&quot;Counter&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>/&gt;</div>
<div class="line">        &lt;Operator <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> type=<span class="stringliteral">&quot;PeriodicDelay&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;UInt32&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1000&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;Input <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">operator</span>=<span class="stringliteral">&quot;0&quot;</span> output=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">        &lt;/Operator&gt;</div>
<div class="line">        &lt;Thread&gt;</div>
<div class="line">            &lt;InputNode <span class="keyword">operator</span>=<span class="stringliteral">&quot;1&quot;</span> input=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">        &lt;/Thread&gt; </div>
<div class="line">    &lt;/Stream&gt;</div>
<div class="line">&lt;/Stromx&gt;</div>
</div><!-- fragment --><p>A stream is described as a list of all its operators and its threads. Each operator must be assigned a unique ID which is used to refer to the same operator when defining connections between operators and when assiging operator connectors to threads. The type of an operator is identified by the a combination of <em>package</em> and <em>type</em>. This allows the use of operators which are defined in third party packages but are not known to the <em>core</em> core library. Parameters of operators can be set by the respective <em>Parameter</em> element. This element contains exactly one <em>Data</em> element which contains the value of the parameter. The type of the data is also specified by the combination of <em>package</em> and <em>type</em>. Again this allows allows to set parameters whose type is defined in an external library and thus not know to core core.</p>
<p>In addition to parameters the <em>Operator</em> element contains a list of its inputs and the outputs these inputs are connected to. As in program in the previous tutorial input and output connectors are identified by the operator the belong to (via the operator ID) and the ID of the respective input or output. In the above example the input <code>0</code> of the second operator (ID <code>1</code>) is connected to the output <code>0</code> of the first operator (ID <code>1</code>).</p>
<p>The same principle holds for the list of input connector elements of a <em>Thread</em> element. Here, the only thread in the stream operates the input connector <code>0</code> of the operator with ID <code>1</code>. The code which reads this XML file is explained in the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stromx/core/Factory.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/XmlReader.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Stream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Core.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Operator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Primitive.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/ReadAccess.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
</div><!-- fragment --><p>Again the programs starts by importing all required header files. In addition to headers which were also included in the last tutorial two more files from the core library are required. On the other hand, the inclusion of the operator headers in the <em>base</em> library is not required anymore. The file <a class="el" href="_base_8h_source.html">base/Base.h</a> is the only one which is needed from this library.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>stromx;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classstromx_1_1core_1_1_factory.html" title="Factory of operator and data objects.">core::Factory</a> factory;  </div>
<div class="line"> </div>
<div class="line">    stromxRegisterCore(factory);</div>
</div><!-- fragment --><p>As a first step a <em>core factory</em> is instantiated. The factory will be used to instantiate all operators and data types which appear in the XML file. After construction the factory is empty, i.e. it does not know any operator or data type. Only after registering a <em>core package</em> the factory can produce operators or data types from this package.</p>
<dl class="section note"><dt>Note:</dt><dd>If the above way of registering a package is used the package must be known at compile time. However, a package can be used even later if the library which contains its code is loaded dynamically during program execution. If the package <em>MyPackage</em> was loaded this way then the function <code>registerMyPackage()</code> would have to be called to allow the import of XML files which use <em>MyPackage</em>.</dd></dl>
<div class="fragment"><div class="line">    core::Stream* stream = core::XmlReader().readStream(<span class="stringliteral">&quot;file.xml&quot;</span>, factory);</div>
<div class="line">    </div>
<div class="line">    stream-&gt;start();</div>
</div><!-- fragment --><p>In the next step a stream is instantiated according the XML file using a core::XmlReader. Note that the previously configured factory is passed to the constructor of core::XmlReader. This way it knows which classes to instantiate if operators or data types are defined by combinations of package and type names. Because the complete configuration of the stream is given in the file the stream is ready to be started after it has been read. In other words, all operators have automatically been initialized, the connections between them have been established and each thread has been informed about its input connectors.</p>
<div class="fragment"><div class="line">    core::Operator* timer = stream-&gt;operators()[1];</div>
</div><!-- fragment --><p>So far a stream was build and started without knowing anything about its internal structure. To have a look at the processed data a specific operator must obviously be addressed. The above line obtains a pointer to the second operator in the stream. Note that <em>second</em> refers to the zero-based position of the operator in the XML file not its ID there.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 5; ++i)</div>
<div class="line">    {</div>
<div class="line">        core::DataContainer data = timer-&gt;getOutputData(0);</div>
<div class="line">        core::ReadAccess&lt;core::UInt32&gt; count(data);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Received &quot;</span> &lt;&lt;  (<span class="keywordtype">unsigned</span> int)(count()) &lt;&lt; std::endl;</div>
<div class="line">        </div>
<div class="line">        timer-&gt;clearOutputData(0);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    stream-&gt;stop();</div>
<div class="line">    stream-&gt;join();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">delete</span> stream;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The rest of the code is exactly the same as in the previous example.</p>
<p>This program illustrates that it is possible to define and operate a stream without knowledge of the exact data types of its operators and their parameters. It is only necessary to either link to the library which contains these types or to dynamically load this library at runtime. In other words, the <em>core</em> core is designed work with any operator which are defined in external packages. The tutorial <a class="el" href="operator.html">Operator</a> shows how to implement such an operator in a custom package. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
