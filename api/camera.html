<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>stromx: Camera</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stromx-logo-rgb-64x64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">stromx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Welcome to stromx!</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Camera </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example is concerned with the detection of edges in images received from a simulated camera input. The layout of the stream is as below.</p>
<div class="image">
<img src="camera.png" alt="camera.png"/>
</div>
<p>The <em>Canny</em> edge detector receives image data from two operators. The first one is the camera which constantly sends images to the edge detector. The second operator <em>BufferArray</em> owns a predefined number of empty image buffers, i.e. pre-allocated, empty images. If <em>BufferArray</em> hands out one of its images to the next operator the image is removed from the array and the <em>BufferArray</em> loses ownership of the image. However, as soon as no other object references the data container which contains the image, the image data is <em>recycled</em>, i.e. it is given back to the <em>BufferArray</em> operator.</p>
<p>In this example the <em>Canny</em> operator computes the edge map of the camera image and writes it to the image buffer it receives from <em>BufferArray</em>. This buffer is then sent to the output of the edge detector operator. In other words, the <em>Canny</em> operator does not own any allocate any image memory during processing but uses only these images it receives as input data. If the party which obtains the output from <em>Canny</em> releases this data soon enough it can be recycled and used again to store the result of the next camera image. The output image of the camera is handled the same way, i.e. as soon as the edge detector finishes processing the camera image is recycled for the acquisition of further images. As a consequence the presented stream can be operated without allocating or deallocating image data.</p>
<dl class="section note"><dt>Note:</dt><dd>The camera has an additional output which contains the index of the current image acquired. If the camera runs out of available image buffers, i.e. if all image buffers are referenced by other objects, the camera can not acquire further images. However, the index is still incremented for each image which should have been acquired. Tracking and comparing the index values allows to find out which frames were lost.</dd></dl>
<p>The illustrated stream is configured by the XML file below. The parameter settings of the operators a commented in the file.</p>
<div class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">&quot;1.0&quot;</span> encoding=<span class="stringliteral">&quot;UTF-8&quot;</span> ?&gt;</div>
<div class="line">&lt;!DOCTYPE Stromx SYSTEM <span class="stringliteral">&quot;stromx.dtd&quot;</span>&gt;</div>
<div class="line"></div>
<div class="line">&lt;Stromx version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">    &lt;Stream&gt;</div>
<div class="line">        &lt;Operator <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span> package=<span class="stringliteral">&quot;Base&quot;</span> type=<span class="stringliteral">&quot;Camera&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">            &lt;!-- output image index --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">                &lt;Data package=<span class="stringliteral">&quot;Core&quot;</span> type=<span class="stringliteral">&quot;Bool&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- image <span class="keywordflow">for</span> camera simulator --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;Image&quot;</span> package=<span class="stringliteral">&quot;Base&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;lenna.jpg&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- software trigger mode --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;Enum&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- the buffer size is 1 MB --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;5&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;UInt32&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1000000&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- one buffer --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;6&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;UInt32&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- 8-bit grayscale output --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;14&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;Enum&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">        &lt;/Operator&gt;</div>
<div class="line">        &lt;Operator <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span> package=<span class="stringliteral">&quot;Base&quot;</span> type=<span class="stringliteral">&quot;Buffer&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">            &lt;!-- one buffer --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;UInt32&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- the buffer size is 1 MB --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;UInt32&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;1000000&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">        &lt;/Operator&gt;</div>
<div class="line">        &lt;Operator <span class="keywordtype">id</span>=<span class="stringliteral">&quot;2&quot;</span> package=<span class="stringliteral">&quot;Base&quot;</span> type=<span class="stringliteral">&quot;Canny&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;</div>
<div class="line">            &lt;!-- threshold 1 --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;Double&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;50&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;!-- threshold 2 --&gt;</div>
<div class="line">            &lt;Parameter <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span>&gt;</div>
<div class="line">                &lt;Data type=<span class="stringliteral">&quot;Double&quot;</span> package=<span class="stringliteral">&quot;Core&quot;</span> version=<span class="stringliteral">&quot;0.1.0&quot;</span>&gt;150&lt;/Data&gt;</div>
<div class="line">            &lt;/Parameter&gt;</div>
<div class="line">            &lt;Input <span class="keywordtype">id</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">operator</span>=<span class="stringliteral">&quot;0&quot;</span> output=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">            &lt;Input <span class="keywordtype">id</span>=<span class="stringliteral">&quot;1&quot;</span> <span class="keyword">operator</span>=<span class="stringliteral">&quot;1&quot;</span> output=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">        &lt;/Operator&gt;</div>
<div class="line">        &lt;Thread&gt;</div>
<div class="line">            &lt;InputConnector <span class="keyword">operator</span>=<span class="stringliteral">&quot;2&quot;</span> input=<span class="stringliteral">&quot;0&quot;</span>/&gt;</div>
<div class="line">            &lt;InputConnector <span class="keyword">operator</span>=<span class="stringliteral">&quot;2&quot;</span> input=<span class="stringliteral">&quot;1&quot;</span>/&gt;</div>
<div class="line">        &lt;/Thread&gt; </div>
<div class="line">    &lt;/Stream&gt;</div>
<div class="line">&lt;/Stromx&gt;</div>
</div><!-- fragment --><p>The program which operates the stream is straightforward. As in the previous examples the program starts by importing all required headers and by registering the <em>core</em> and <em>base</em> libraries.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stromx/core/Factory.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/XmlReader.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Stream.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Core.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Operator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/ReadAccess.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/core/Image.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/base/Base.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stromx/base/Camera.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>stromx;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classstromx_1_1core_1_1_factory.html" title="Factory of operator and data objects.">core::Factory</a> factory;</div>
<div class="line">    </div>
<div class="line">    stromxRegisterCore(factory);</div>
<div class="line">    stromxRegisterBase(factory);</div>
</div><!-- fragment --><p>Next the stream is read from the XML file and started.</p>
<div class="fragment"><div class="line">    core::Stream* stream = core::XmlReader().readStream(<span class="stringliteral">&quot;camera.xml&quot;</span>, factory);</div>
<div class="line">    </div>
<div class="line">    stream-&gt;start();</div>
<div class="line">    </div>
<div class="line">    core::Operator* camera = stream-&gt;operators()[0];</div>
<div class="line">    core::Operator* canny = stream-&gt;operators()[2];</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 5; ++i)</div>
<div class="line">    {</div>
<div class="line">        core::DataContainer data = canny-&gt;getOutputData(0);</div>
<div class="line">        core::ReadAccess&lt;core::Image&gt; image(data);</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Received image &quot;</span> &lt;&lt;  image().height() &lt;&lt; <span class="stringliteral">&quot;x&quot;</span> &lt;&lt; image().width() &lt;&lt; std::endl;</div>
<div class="line">        </div>
<div class="line">        canny-&gt;clearOutputData(0);</div>
<div class="line">        camera-&gt;clearOutputData(1);</div>
<div class="line">    }</div>
</div><!-- fragment --><p>Before starting the iteration explicit references to the <em>Camera</em> and <em>Canny</em> operators are acquired. In each step the output image of the edge detector is obtained and its dimension are written to the command line. After that the output of the edge detector and the index output of the camera are cleared. It is important to clear <em>all</em> outputs which are not connected to other operators. Not doing so would eventually stop stream because no further data can be send to the outputs. </p>
<div class="fragment"><div class="line">    stream-&gt;stop();</div>
<div class="line">    stream-&gt;join();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">delete</span> stream;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, the stream is stopped and deleted.</p>
<dl class="section note"><dt>Note:</dt><dd>The class core::Image does not support saving of images to file because core is not linked to any 3rd party image processing library. However, base::Image can write image files using OpenCV. Thus, the images in the code above can be written by constructing base::Image objects from the more general core::Image data:</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;base/Image.h&gt;</span></div>
<div class="line">...</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 5; ++i)</div>
<div class="line">    {</div>
<div class="line">        ...</div>
<div class="line">        base::Image baseImage(image())</div>
<div class="line">        baseImage.save(&quot;image.png&quot;);</div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
